#!/usr/bin/python
# -*-  coding: utf-8 -*-

##
# Current source: https://github.com/open-security/vulnpwn/
##

from lib.core import exploit


class Module(exploit.Exploit):

    __info__ = {
        'name': 'autopwn scanner',
        'author': ['Open-Security'],
        'description': 'scan target with all exploits modules automatically',
        'references': ['https://github.com/open-security/vulnpwn'],
        'disclosureDate': 'June 10 2016',
        'license': 'APACHE_LICENSE',
        'options': {
            'RHOST': ['192.168.1.1', 'the target host'],
            'RPORT': [80, 'the target port']
        }
    }

    def __init__(self):
        exploit.Exploit.__init__(self)

    def check(self):
        autopwn_host = self.get_option_value('RHOST')
        autopwn_port = self.get_option_value('RPORT')

        modules = self.modules
        exclude = 'exploits.autopwn'
        exclude in modules and modules.remove(exclude)
        modules = [_ for _ in modules if 'payloads.' not in _]
        for current_module in self.import_modules(modules):
            if hasattr(current_module, 'Module'):
                current_module = current_module.Module()

                if autopwn_host:
                    current_module.rhost = autopwn_host

                if autopwn_port:
                    current_module.rport = autopwn_port
                current_module.check()

    def main(self, *args, **kwargs):
        self.check()
